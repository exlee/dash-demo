var app_module;app_module=angular.module("App",["ui"]).config(["$routeProvider",function(e){return e.when("/",{controller:"DashboardController",templateUrl:"partials/dashboard.html"}).otherwise({redirectTo:"/"})}]).run(["$rootScope",function(e){return e.resizeContainers=function(){var e;return e=$(window).height()-$("#header").height(),$("#content").css({"min-height":e*.7,"max-height":e*.7,height:e*.7}),$("#footer").css({"min-height":e*.3,"max-height":e*.3,height:e*.3})},$(window).resize(function(t){return e.resizeContainers()}),$(window).load(function(t){return e.resizeContainers()})}]),app_module.directive("pkPlot",function(){return{restrict:"E",replace:!1,scope:{itm:"=",plot:"=",click:"&",cats:"=",id:"@"},link:function(e,t,n,r){var i,s,o,u,a,f;return a={},f=0,i=0,o=20,u=10,s=!1,$(window).resize(function(){return e.refreshVis()}),$(window).load(function(){return e.refreshVis()}),e.$watch("cats",function(){if(s===!0)return e.draw()},!0),e.$watch("plot.refresh",function(t){if(t>3)return e.refreshVis()},!0),e.unique_data_points=[],e.refreshVis=function(){var n;return n=d3.select(t[0]).select("svg").remove(),a=d3.select(t[0]).append("svg").attr("width",function(e,n){return t.css("width")}).attr("height",function(e,n){return t.css("height")}),f=parseInt(t.css("width")),i=parseInt(t.css("height")),e.x=d3.scale.linear().domain([e.plot.minX,e.plot.maxX]).range([0+o,f-o]),e.y=d3.scale.linear().domain([e.plot.minY,e.plot.maxY]).range([i-o,0+o]),a.append("g").attr("class","unique"),a.append("g").attr("class","duplicate"),a.append("line").attr("x1",0).attr("y1",0).attr("x2",0).attr("y2",i-u).attr("stroke",d3.rgb("black")).attr("stroke-width",3),a.append("line").attr("x1",0).attr("y1",i-u).attr("x2",f-u).attr("y2",i-u).attr("stroke",d3.rgb("black")).attr("stroke-width",2),s=!0,e.draw()},e.expandGroup=function(t,n){var r,i,s,u,f,l,c;a.select("g.expand").remove(),r=a.append("g").attr("class","expand"),i=[],c=e.itm;for(f=0,l=c.length;f<l;f++)u=c[f],u.x===t&&u.y===n&&e.cats[u.category].active&&i.push(u);return s=d3.scale.linear().domain([0,i.length-1]).range([e.x(t)-40+o,e.x(t)+40-o]),r.append("rect").attr("x",e.x(t)-40).attr("y",e.y(n)-20).attr("rx",5).attr("ry",5).attr("width",80).attr("height",40).attr("stroke",d3.rgb("#57A8FF")).attr("stroke-width",2).attr("opacity",0).transition().attr("opacity",1),r.append("text").attr("x",e.x(t)-38).attr("y",e.y(n)-6).text("X").attr("cursor","pointer").on("click",function(){return r.attr("opacity",1).transition().attr("opacity",0).remove()}),r.selectAll("circle").data(i).enter().append("circle").attr("cx",function(e,t){return s(t)}).attr("cy",e.y(n)).attr("stroke",function(e){return d3.rgb(e.category)}).attr("r",5).on("click",function(t,n){return e.click({id:t.id})}).attr("opacity",0).transition().attr("opacity",1)},e.canBeDisplayed=function(t,n){var r;return n==null&&(n=void 0),r=t.x>=e.plot.minX&&t.x<=e.plot.maxX&&t.y>=e.plot.minY&&t.y<=e.plot.maxY&&e.cats[t.category].active,n?r&&n[t.x+"|"+t.y]===1:r},e.draw=function(){var t,n,r,s,u,f,l,c,h,p,d,v,m,g,y,b,w,E,S,x,T,N,C,k,L,A,O,M,_,D,P,H;u={},O=e.unique_data_points;for(y=0,S=O.length;y<S;y++)l=O[y],l["delete"]=!0;M=e.itm;for(b=0,x=M.length;b<x;b++)l=M[b],e.canBeDisplayed(l)&&(c=l.x+"|"+l.y,u[c]?u[c]+=1:u[c]=1);_=e.itm;for(w=0,T=_.length;w<T;w++){l=_[w];if(e.canBeDisplayed(l,u)){f=!1,D=e.unique_data_points;for(E=0,N=D.length;E<N;E++)n=D[E],n===l&&(f=!0,n["delete"]=!1);f||(l["delete"]=!1,e.unique_data_points.push(l))}}p=[],P=e.unique_data_points;for(L=0,C=P.length;L<C;L++)l=P[L],l["delete"]===!1&&p.push(l);e.unique_data_points=p,d=a.select("g.unique").selectAll("circle").data(e.unique_data_points,function(e){return e.id}),d.enter().append("circle").attr("cx",function(t){return e.x(t.x)}).attr("cy",i-o).attr("stroke",function(e){return d3.rgb(e.category)}).attr("r",5).on("click",function(t,n){return e.click({id:t.id})}).attr("opacity",0).transition().duration(800).attr("opacity",1).attr("cy",function(t){return e.y(t.y)}),d.exit().transition().duration(800).attr("cy",o).attr("opacity",0).remove(),h=[];for(c in u){v=u[c];if(v>1){m=parseInt(c.split("|")[0]),g=parseInt(c.split("|")[1]),t=0,c=[],H=e.itm;for(A=0,k=H.length;A<k;A++)l=H[A],l.x===m&&l.y===g&&e.canBeDisplayed(l)&&(t++,c.push(l.id));t>0&&h.push([m,g,t,c.join("|")])}}return r=a.select("g.duplicate").selectAll("rect").data(h,function(e){return e[3]}),r.enter().append("rect").attr("x",function(t){return e.x(t[0])-12}).attr("y",function(t){return e.y(t[1])-12}).attr("rx",2).attr("ry",2).attr("stroke",d3.rgb("#57A8FF")).attr("stroke-width",3).attr("width",24).attr("height",24).attr("fill",d3.rgb("white")).attr("opacity",0).on("click",function(t){return m=t[0],g=t[1],e.expandGroup(m,g)}).transition().duration(1e3).attr("opacity",1),r.exit().transition().attr("opacity",0).remove(),s=a.select("g.duplicate").selectAll("text").data(h,function(e){return e[3]}),s.enter().append("text").text(function(e){return e[2]}).attr("x",function(t){return m=t[0],e.x(m)-5}).attr("y",function(t){return g=t[1],e.y(g)+5}).attr("fill",d3.rgb("black")).attr("font-family","sans-serif").attr("font-size","16px").attr("font-weight","bold").attr("opacity",0).on("click",function(t){return m=t[0],g=t[1],e.expandGroup(m,g)}).transition().duration(1e3).attr("opacity",1),s.exit().transition().attr("opacity",0).remove()}}}});var DashboardController;DashboardController=["$scope","$http","$routeParams",function(e,t,n){var r,i,s,o,u,a,f,l,c,h,p;e.data=[],e.categories={},e.position_keys={},e.all_categories="",e.refresh_cycle=0,a=function(){return"("+this.minX+","+this.minY+") to ("+this.maxX+","+this.maxY+")"},e.grid={"Plot 1":{id:"plot_1",active:!0,minX:-10,minY:0,maxX:0,maxY:10,repr:a,refresh:0},"Plot 2":{id:"plot_2",active:!1,minX:0,minY:0,maxX:10,maxY:10,repr:a,refresh:0},"Plot 3":{id:"plot_3",active:!1,minX:-10,minY:-10,maxX:0,maxY:0,repr:a,refresh:0},"Plot 4":{id:"plot_4",active:!1,minX:0,minY:-10,maxX:10,maxY:0,repr:a,refresh:0}},e.position_keys=["x","y"],r={color:["red","blue","orange","gold","silver","magenta"]};for(s in r){f=r[s];for(c=0,p=f.length;c<p;c++)i=f[c],e.categories[i]={"class":""}}for(l=h=1;h<=100;l=++h)u={id:l},o=[-10,-9,-8,-7,-6,-5,-4,-3,-2,-1,0,1,2,3,4,5,6,7,8,9,10],u.x=o[Math.floor(Math.random()*o.length)],u.y=o[Math.floor(Math.random()*o.length)],o=r.color,u.category=o[Math.floor(Math.random()*o.length)],e.data.push(u);return e.data.push({id:101,x:-5,y:5,category:"gold"}),e.data.push({id:102,x:-5,y:5,category:"gold"}),e.toggleCategory=function(e){return e.active=!e.active,e.active?e["class"]="active":e["class"]=""},e.toggleAllCategories=function(){var t,n,r,i,s,o;if(e.all_categories){r=e.categories,s=[];for(t in r)n=r[t],n["class"]="",s.push(n.active=!1);return s}i=e.categories,o=[];for(t in i)n=i[t],n["class"]="active",o.push(n.active=!0);return o},e.activeCategory=function(t){return e.categories[t].active?!0:!1},e.resizeGrid=function(){var t,n,r,i,o,u,a,f,l,c,h,p,d;l=5,c=5,t=2,a=0,p=e.grid;for(s in p)h=p[s],h.active&&a++;u=Math.ceil(a/2),a>1?f=2:f=1,i=$("#content").height(),n=Math.floor(i/u),n-=2*(l+c+t),o=$(".plot_cell").parents(".span10").width(),r=Math.floor(o/f),r-=2*(l+c+t),$(".plot_cell").each(function(){return $(this).css({"min-height":n,"max-height":n,height:n,width:r})}),d=[];for(s in e.grid)d.push(e.grid[s].refresh+=1);return d},e.scrollTo=function(e){var t;if($("#row_"+e).position().top!==0)return t=$("#row_"+e),$("#footer").animate({scrollTop:t.offset().top-$("#footer").offset().top+$("#footer").scrollTop()},1e3)},e.$watch("categories",function(){var t,n;t=!0,n=e.categories;for(s in n)f=n[s],f.active||(t=!1);return t?e.all_categories="active":e.all_categories=""},!0),e.$watch(function(){e.refresh_cycle===2&&(e.refresh_cycle=0),e.refresh_cycle===1&&(e.refresh_cycle=2),e.refresh_cycle===0}),e.$watch("grid",function(){if(e.refresh_cycle===0)return e.refresh_cycle+=1,e.resizeGrid()},!0),$(document).ready(function(){return e.categories.gold.active=!0,e.categories.gold["class"]="active"}),$(window).load(function(){return e.resizeGrid()}),$(window).resize(function(){return e.resizeGrid()})}]